!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Game=e()}}(function(){return function e(t,r,n){function i(o,c){if(!r[o]){if(!t[o]){var a="function"==typeof require&&require;if(!c&&a)return a(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){var r=t[o][1][e];return i(r||e)},l,l.exports,e,t,r,n)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,c,a,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r=this._events[e],o(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:c=Array.prototype.slice.call(arguments,1),r.apply(this,c)}else if(s(r))for(c=Array.prototype.slice.call(arguments,1),n=(u=r.slice()).length,a=0;a<n;a++)u[a].apply(this,c);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(r=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,o,c;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(r)){for(c=o;c-- >0;)if(r[c]===t||r[c].listener&&r[c].listener===t){n=c;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(){d&&f&&(d=!1,f.length?m=f.concat(m):v=-1,m.length&&c())}function c(){if(!d){var e=s(o);d=!0;for(var t=m.length;t;){for(f=m,m=[];++v<t;)f&&f[v].run();v=-1,t=m.length}f=null,d=!1,function(e){if(p===clearTimeout)return clearTimeout(e);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}(e)}}function a(e,t){this.fun=e,this.array=t}function u(){}var l,p,h=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(e){p=i}}();var f,m=[],d=!1,v=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];m.push(new a(e,t)),1!==m.length||d||s(c)},a.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.prependListener=u,h.prependOnceListener=u,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],3:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],4:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],5:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:o};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(t)?n.showHidden=t:t&&r._extend(n,t),d(n.showHidden)&&(n.showHidden=!1),d(n.depth)&&(n.depth=2),d(n.colors)&&(n.colors=!1),d(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=s),c(n,e,n.depth)}function s(e,t){var r=i.styles[t];return r?"["+i.colors[r][0]+"m"+e+"["+i.colors[r][1]+"m":e}function o(e,t){return e}function c(e,t,n){if(e.customInspect&&t&&x(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return m(i)||(i=c(e,i,n)),i}var s=function(e,t){if(d(t))return e.stylize("undefined","undefined");if(m(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(f(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(h(t))return e.stylize("null","null")}(e,t);if(s)return s;var o=Object.keys(t),g=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),w(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return a(t);if(0===o.length){if(x(t)){var k=t.name?": "+t.name:"";return e.stylize("[Function"+k+"]","special")}if(v(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(y(t))return e.stylize(Date.prototype.toString.call(t),"date");if(w(t))return a(t)}var b="",_=!1,O=["{","}"];if(l(t)&&(_=!0,O=["[","]"]),x(t)){b=" [Function"+(t.name?": "+t.name:"")+"]"}if(v(t)&&(b=" "+RegExp.prototype.toString.call(t)),y(t)&&(b=" "+Date.prototype.toUTCString.call(t)),w(t)&&(b=" "+a(t)),0===o.length&&(!_||0==t.length))return O[0]+b+O[1];if(n<0)return v(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var T;return T=_?function(e,t,r,n,i){for(var s=[],o=0,c=t.length;o<c;++o)E(t,String(o))?s.push(u(e,t,r,n,String(o),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(u(e,t,r,n,i,!0))}),s}(e,t,n,g,o):o.map(function(r){return u(e,t,n,g,r,_)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(T,b,O)}function a(e){return"["+Error.prototype.toString.call(e)+"]"}function u(e,t,r,n,i,s){var o,a,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),E(n,i)||(o="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=h(r)?c(e,u.value,null):c(e,u.value,r-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),d(o)){if(s&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function l(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function h(e){return null===e}function f(e){return"number"==typeof e}function m(e){return"string"==typeof e}function d(e){return void 0===e}function v(e){return g(e)&&"[object RegExp]"===k(e)}function g(e){return"object"==typeof e&&null!==e}function y(e){return g(e)&&"[object Date]"===k(e)}function w(e){return g(e)&&("[object Error]"===k(e)||e instanceof Error)}function x(e){return"function"==typeof e}function k(e){return Object.prototype.toString.call(e)}function b(e){return e<10?"0"+e.toString(10):e.toString(10)}function E(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var _=/%[sdj%]/g;r.format=function(e){if(!m(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(i(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,s=n.length,o=String(e).replace(_,function(e){if("%%"===e)return"%";if(r>=s)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),c=n[r];r<s;c=n[++r])h(c)||!g(c)?o+=" "+c:o+=" "+i(c);return o},r.deprecate=function(e,i){if(d(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return function(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}};var O,T={};r.debuglog=function(e){if(d(O)&&(O=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!T[e])if(new RegExp("\\b"+e+"\\b","i").test(O)){var n=t.pid;T[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else T[e]=function(){};return T[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=l,r.isBoolean=p,r.isNull=h,r.isNullOrUndefined=function(e){return null==e},r.isNumber=f,r.isString=m,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=d,r.isRegExp=v,r.isObject=g,r.isDate=y,r.isError=w,r.isFunction=x,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",function(){var e=new Date,t=[b(e.getHours()),b(e.getMinutes()),b(e.getSeconds())].join(":");return[e.getDate(),j[e.getMonth()],t].join(" ")}(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!g(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":4,_process:2,inherits:3}],6:[function(e,t,r){const n=e("./shapes"),{GetMove:i}=e("./moves"),s=function(e={}){this.value=e.value,this.shape=e.shape,this.image=e.image,this.move=i(e.value),this.matches=((e=new s)=>e.shape===this.shape||e.value===this.value||e.shape===n.Whot||this.shape===n.Whot),this.render=(()=>`${this.shape} (${this.value})`);const t=this;Object.assign(this,{get score(){return t.shape===n.Star?2*t.value:t.value}})};t.exports=s,t.exports.GetTriangle=((e={})=>new s(Object.assign(Object.assign({},e),{shape:n.Triangle}))),t.exports.GetCircle=((e={})=>new s(Object.assign(Object.assign({},e),{shape:n.Circle}))),t.exports.GetSquare=((e={})=>new s(Object.assign(Object.assign({},e),{shape:n.Square}))),t.exports.GetStar=((e={})=>new s(Object.assign(Object.assign({},e),{shape:n.Star}))),t.exports.GetWhot=((e={})=>new s(Object.assign(Object.assign({},e),{shape:n.Whot,value:20}))),t.exports.GetCross=((e={})=>new s(Object.assign(Object.assign({},e),{shape:n.Cross})))},{"./moves":14,"./shapes":17}],7:[function(e,t,r){e("./card");const n=e("./logger")("deck.js"),i=e("events").EventEmitter,{GetCircle:s,GetStar:o,GetSquare:c,GetCross:a,GetTriangle:u,GetWhot:l}=e("./card"),p=(e("./shapes"),[1,2,3,4,5,7,8,10,11,12,13,14]),h=[1,2,3,4,5,7,8,10,11,12,13,14],f=[1,2,3,5,7,10,11,13,14],m=[1,2,3,5,7,10,11,13,14],d=[1,2,3,4,5,7,8],v=[20,20,20,20,20];t.exports=function(e={}){e.emitter||(n.warn("props.emitter not defined"),e.emitter=new i),this.cards=[].concat(p.map(e=>s({value:e}))).concat(h.map(e=>u({value:e}))).concat(f.map(e=>a({value:e}))).concat(m.map(e=>c({value:e}))).concat(d.map(e=>o({value:e}))).concat(v.map(e=>l({value:e}))),e.emitter.emit("deck:create",this.cards),this.shuffle=(()=>{const t=this.cards.map((e,t)=>t).sort((e,t)=>Math.random()-.5).map(e=>this.cards[e]);return e.emitter.emit("deck:shuffle",t),t})}},{"./card":6,"./logger":12,"./shapes":17,events:1}],8:[function(e,t,r){t.exports=(e=>t=>{const r=new Error(t);return r.name=e,r}),t.exports.createTypeError=(e=>(t,r)=>{const n=new TypeError(t);return n.type=r,n.name=e,n})},{}],9:[function(e,t,r){const n=e("events").EventEmitter,i=new n;t.exports=i,t.exports.EventEmitter=n,t.exports.raiseEvent=((e,...t)=>{i.emit(e,...t)}),t.exports.eventify=(e=>{e.events={},e.on=function(t,r){"object"!=typeof e.events[t]&&(e.events[t]=[]),e.events[t].push(r)},e.removeListener=function(t,r){let n;"object"==typeof e.events[t]&&(n=e.events[t].indexOf(r))>-1&&e.events[t].splice(n,1)},e.emit=function(t){var r,n,i,s=[].slice.call(arguments,1);if("object"==typeof e.events[t])for(i=(n=e.events[t].slice()).length,r=0;r<i;r++)n[r].apply(e,s)},e.once=function(t,r){e.on(t,function n(){e.removeListener(t,n),r.apply(e,arguments)})}})},{events:1}],10:[function(e,t,r){const{GetCircle:n}=e("./card"),i=(e("./card"),e("./deck"),e("./market")),s=e("./pile"),o=e("./player"),c=e("./turn"),a=e("./events"),{createTypeError:u}=e("./errors"),{eventify:l}=e("./events"),p=(e("./errors"),e("./logger")("index.js"),u("InvalidArgumentTypeError"));t.exports=function(e={}){if(e.noOfDecks=Number(e.noOfDecks||1),!Number(e.noOfDecks))throw p("props.noOfDecks");if(!Number(e.noOfPlayers))throw p("props.noOfPlayers");l(this);const t=new s({emitter:a}),r=new i({noOfDecks:e.noOfDecks,emitter:a,pile:()=>t}),u=[];for(let n=1;n<=e.noOfPlayers;n++){const e=new o({id:n,emitter:a,market:()=>r,pile:()=>t});u.push(e)}const h=new c({players:u,emitter:a});this.turn=h,this.market=r,this.pile=t,this.emitter=a;(()=>{for(let e=1;e<=4;e++)u.forEach(e=>{e.pick()})})(),h.execute((()=>{const e=[n({value:5})];return t.push(e),e[0]})(),!0)}},{"./card":6,"./deck":7,"./errors":8,"./events":9,"./logger":12,"./market":13,"./pile":15,"./player":16,"./turn":18}],11:[function(e,t,r){t.exports.Reset="[0m",t.exports.Bright="[1m",t.exports.Dim="[2m",t.exports.Underscore="[4m",t.exports.Blink="[5m",t.exports.Reverse="[7m",t.exports.Hidden="[8m",t.exports.FgBlack="[30m",t.exports.FgRed="[31m",t.exports.FgGreen="[32m",t.exports.FgYellow="[33m",t.exports.FgBlue="[34m",t.exports.FgMagenta="[35m",t.exports.FgCyan="[36m",t.exports.FgWhite="[37m",t.exports.BgBlack="[40m",t.exports.BgRed="[41m",t.exports.BgGreen="[42m",t.exports.BgYellow="[43m",t.exports.BgBlue="[44m",t.exports.BgMagenta="[45m",t.exports.BgCyan="[46m",t.exports.BgWhite="[47m"},{}],12:[function(e,t,r){const n=e("./colors");t.exports=(e=>({log:(t,...r)=>console.log(`${e}:`,n.FgCyan,t,...r,n.Reset),warn:(t,...r)=>console.warn(`${e} (warn):`,n.FgYellow,t,...r,n.Reset),error:(t,...r)=>console.error(`${e} (error):`,n.FgRed,t,...r,n.Reset)}))},{"./colors":11}],13:[function(e,t,r){const n=e("./deck"),i=(e("../src/card"),e("../src/shapes"),e("./errors")),{createTypeError:s}=e("./errors"),o=e("events").EventEmitter,c=e("./logger")("market.js"),a=i("OutOfRangeError");t.exports=function(e={}){e.noOfDecks=e.noOfDecks||1,e.emitter||(c.warn("props.emitter not defined"),e.emitter=new o);let t=[];for(let r=1;r<=e.noOfDecks;r++)new n({emitter:e.emitter}).shuffle().forEach(e=>t.push(e));e.emitter.emit("market:create",t.slice(0)),this.pick=((r=1)=>{if(r>=t.length){if(!e.pile)throw a("cards");e.pile().reset().forEach(e=>t.push(e)),t=t.sort((e,t)=>Math.random()-.5)}const n=t.splice(0,r);return e.emitter.emit("market:pick",n),n}),this.count=(()=>t.length)}},{"../src/card":6,"../src/shapes":17,"./deck":7,"./errors":8,"./logger":12,events:1}],14:[function(e,t,r){const n={PickTwo:"PickTwo",PickThree:"PickThree",GeneralMarket:"GeneralMarket",HoldOn:"HoldOn",Suspension:"Suspension",None:"None"};t.exports=n;t.exports.GetMove=(e=>2===e?n.PickTwo:5===e?n.PickThree:14===e?n.GeneralMarket:1===e?n.HoldOn:8===e?n.Suspension:n.None)},{}],15:[function(e,t,r){e("./deck"),e("../src/card"),e("../src/shapes");const n=e("./errors"),{createTypeError:i}=e("./errors"),s=e("events").EventEmitter,o=e("./logger")("pile.js"),c=i("InvalidArgumentTypeError"),a=n("LastCardMismatchError"),u=n("NoCardSuppliedError");t.exports=function(e={}){e.emitter||(o.warn("props.emitter not defined"),e.emitter=new s);const t=[];this.top=(()=>t[t.length-1]||null),this.push=((r=[])=>{if(!Array.isArray(r))throw c("_cards_",Array);if(!(r.length>0))throw u();{const n=r[r.length-1];if(this.top()&&!this.top().matches(n))throw a({pile:this.top(),play:n});r.forEach(e=>t.push(e)),e.emitter.emit("pile:push",r)}}),this.reset=(()=>(e.emitter.emit("pile:reset",this.top()),t.splice(0,t.length-1)))}},{"../src/card":6,"../src/shapes":17,"./deck":7,"./errors":8,"./logger":12,events:1}],16:[function(e,t,r){const n=e("./shapes"),{renderShape:i}=e("./shapes"),s=e("./errors"),{createTypeError:o}=e("./errors"),{eventify:c}=e("./events"),a=e("events").EventEmitter,u=(e("./card"),e("./pile"),e("./market"),e("./moves")),l=(e("util"),e("./logger")("player.js")),p=s("CardNotFoundError"),h=s("OutOfTurnError"),f=s("InvalidArgumentError"),m=s("ExpectedToPickError"),d=s("PlayValidationFailedError"),v=o("InvalidArgumentTypeError");t.exports=function(e){if(!e)throw f("props");if(!e.id)throw f("props.id");if(e.emitter||(l.warn("No EventEmitter supplied"),e.emitter=new a),!e.market||"function"!=typeof e.market)throw f("props.market");if(e.pile){if("function"!=typeof e.pile)throw f("props.pile must be a function")}else l.warn("No Pile Function supplied");const t=[];this.id=e.id,this.turn=!1,this.toPick=0,this.add=((r=[])=>{if(!Array.isArray(r))throw v("_cards_",Array);r.forEach(e=>t.push(e)),e.emitter.emit("player:add",r),this.emit("add",r)}),this.hand=(()=>t.slice(0)),this.pick=(()=>{const t=e.market().pick(this.toPick||1);if(!Array.isArray(t))throw new v("marketCards",Array);return this.add(t),this.emit("market",t),e.emitter.emit("player:market",this,t),this.toPick=0,t}),this.play=(r=>{if(!this.turn)throw h(this);{const i=t[r];if(!i)throw p(this);if(0!==this.toPick&&i.shape!==n.Whot)throw m(this);if((t=>e.pile().top().matches(t))(i))return t.splice(r,1),this.emit("play",i),e.emitter.emit("player:play",this,i),e.pile&&e.pile().push([i]),this.empty()&&(e.pile().top().move===u.None?(e.emitter.emit("player:checkup",this),this.emit("checkup")):this.pick()),this.lastCard()&&(e.emitter.emit("player:last-card",this),this.emit("last-card")),i;if("function"==typeof e.validator&&!e.validator(i))throw d(JSON.stringify(i))}}),this.lastCard=(()=>1===t.length),this.empty=(()=>0===t.length),this.canPlay=(()=>t.findIndex(t=>t.matches(e.pile().top()))>=0&&0===this.toPick),this.render=(()=>`id: ${this.id} count: ${t.length} hand: [${t.map(e=>e.value+i(e.shape)).join(",")}]`),c(this)}},{"./card":6,"./errors":8,"./events":9,"./logger":12,"./market":13,"./moves":14,"./pile":15,"./shapes":17,events:1,util:5}],17:[function(e,t,r){const n={Circle:"Circle",Triangle:"Triangle",Cross:"Cross",Square:"Square",Star:"Star",Whot:"Whot"};t.exports=n,t.exports.renderShape=(e=>{switch(e){case n.Circle:return"c";case n.Cross:return"+";case n.Square:return"s";case n.Star:return"*";case n.Whot:return"w";case n.Triangle:return"t";default:return e}})},{}],18:[function(e,t,r){const n=e("./errors"),{createTypeError:i}=e("./errors"),s=e("events").EventEmitter,o=(e("./player"),e("./logger")("turn.js")),c=(e("./card"),e("./moves")),a=n("PlayersNotEnoughError"),u=n("InvalidArgumentError"),l=n("InappropriateMoveError"),p=i("InvalidArgumentTypeError");t.exports=function(e={}){if(!Array.isArray(e.players))throw p("props.players",Array);e.emitter||(o.warn("props.emitter not undefined"),e.emitter=new s);const t=e.players;if(0===t.length)throw a();t.forEach((e,t)=>{e.turn=0===t}),this.next=(()=>t.find(e=>e.turn)),this.switch=((r=0)=>{const n=(t.findIndex(e=>e.turn)+ ++r)%t.length,i=t[n];return this.next().turn=!1,i.turn=!0,e.emitter.emit("turn:switch",r,i),this}),this.setToPick=((e,r,n)=>{if(!Number(e))throw u("noOfPlayers");if(!Number(r))throw u("count");let i=n?-1:t.findIndex(e=>e.turn);const s=[];for(let n=1;n<=e;n++){let e=++i%t.length;t[e].toPick=r,s.push(t[e])}return s}),this.holdon=(t=>{e.emitter.emit("turn:holdon",r(this.count()-1)),t||this.switch(this.count()-1)}),this.pickTwo=(t=>{let r=this.next();if(0===r.toPick||2===r.toPick){const n=this.setToPick(1,r.toPick+2,t);return t||(r.toPick=0),e.emitter.emit("turn:pick-two",n[0]),t||this.switch(),this}throw l("pickTwo")}),this.pickThree=(t=>{let r=this.next();if(0===r.toPick||3===r.toPick){const n=this.setToPick(1,r.toPick+3,t);return t||(r.toPick=0),e.emitter.emit("turn:pick-three",n[0]),t||this.switch(),this}throw l("pickThree")});const r=e=>{const r=[];let n=t.findIndex(e=>e.turn);for(let i=1;i<=e;i++){let e=++n%t.length;r.push(t[e])}return r};this.suspension=((t,n)=>{e.emitter.emit("turn:suspension",r(t?2:1)),n||this.switch(t?2:1)}),this.generalMarket=(t=>{const r=this.setToPick(this.count()-1,1,t);return e.emitter.emit("turn:general-market",r),t||this.switch(),r}),this.count=(()=>t.length),this.execute=((e,t)=>{e.move===c.GeneralMarket?this.generalMarket(t):e.move===c.HoldOn?this.holdon(t):e.move===c.PickThree?this.pickThree(t):e.move===c.PickTwo?this.pickTwo(t):e.move===c.Suspension?this.suspension(t):t||this.switch()})}},{"./card":6,"./errors":8,"./logger":12,"./moves":14,"./player":16,events:1}]},{},[10])(10)});